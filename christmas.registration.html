<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2025è–èª•ç¯€å ±åè¡¨å–®</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
      /* ç§»é™¤èƒŒæ™¯åœ–ç‰‡ï¼Œå› ç‚ºDMå°‡ä½œç‚º<img>å‘ˆç¾ */
      background-color: #f0f0f0; 
      color: #333;
    }

    .form-container {
      width: 340px;
      padding: 40px 25px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-top: 40px;
      margin-bottom: 40px;
      background-color: #fff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* DM åœ–ç‰‡æ¨£å¼ */
    .dm-image {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto 25px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* ğŸš¨ æ–°å¢ï¼šå¿…å¡«æ˜Ÿè™Ÿæ¨£å¼ */
    .required-star {
        color: #e74c3c; /* é®®ç´…è‰² */
        font-weight: bold;
        margin-right: 2px;
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
      font-size: 22px;
      font-weight: bold;
      color: #2c3e50;
    }

    .preface-text {
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 30px;
      color: #555;
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      border: 1px dashed #ccc;
    }
    .preface-text strong {
      color: #e67e22;
    }

    label {
      display: block;
      margin-bottom: 20px;
      font-size: 14px;
      color: #333;
    }

    input[type="text"],
    input[type="email"],
    select {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
      background-color: #f9f9f9;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    select:focus {
      border-color: #8c7ae6;
      outline: none;
      box-shadow: 0 0 5px rgba(140, 122, 230, 0.3);
    }

    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 12px;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }

    .primary-btn {
      background-color: #8c7ae6; /* ç´«è‰²èª¿ */
      color: #fff;
    }
    .primary-btn:hover {
      background-color: #7262c0;
    }

    .secondary-btn {
      background-color: #fbd46d; /* é»ƒè‰²èª¿ */
      color: #333;
    }
    .secondary-btn:hover {
      background-color: #f9c240;
    }

    .cancel-btn {
      background-color: #b2bec3; /* æ·ºç°è‰² */
      color: #333;
    }
    .cancel-btn:hover {
      background-color: #95a5a6;
    }

    .radio-group, .checkbox-group {
      margin-bottom: 20px;
      font-size: 14px;
      color: #333;
    }

    /* èª¿æ•´å–®é¸/å¤šé¸é¸é …çš„é–“è· */
    .radio-group label, .checkbox-group label {
      display: inline-block;
      margin-right: 15px;
      margin-bottom: 5px;
      font-weight: normal;
    }
    .radio-group input[type="radio"], .checkbox-group input[type="checkbox"] {
      margin-right: 5px;
    }

    .hidden {
      display: none;
    }

    .success-msg {
      text-align: center;
      margin-top: 20px;
      color: green;
      font-weight: bold;
    }
    .error-msg {
      text-align: center;
      margin-top: 20px;
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  
<div class="form-container" id="step1">
    <h1>2025è–èª•ç¯€å ±åè¡¨å–®</h1>
    <img src="DM.jpg" alt="æ´»å‹•DM" class="dm-image" />
    
    <div class="preface-text">
      <strong>æ´»å‹•è³‡è¨Šï¼š</strong><br>
      æ—¥æœŸï¼š12/20ï¼ˆå…­ï¼‰14:30~16:00ï¼ˆ13:30å¯å…¥å ´ï¼‰<br>
      åœ°é»ï¼šæ–°ç«¹å¸‚è–ç¶“æ›¸é™¢ï¼ˆæ–°ç«¹å¸‚é«˜å³°è·¯56è™Ÿï¼‰<br>
      <a href="https://share.google/f1dS9UyDbc0sHf4Ln" target="_blank">Google Map</a><br>
      åœè»Šè³‡è¨Šï¼š<br>
      1.è–ç¶“æ›¸é™¢åœè»Šä½ï¼ˆæ©Ÿè»Šã€æ±½è»Šä½æœ‰é™ï¼‰<br>
      2.é™„è¿‘åœè»Šæ ¼<br>
      3.é™„è¿‘åœè»Šå ´ï¼ˆ50å…ƒ/åŠå°æ™‚ï¼Œ1å¤©æœ€é«˜280å…ƒï¼‰<br>
     ï¼ˆ1ï¼‰è¥¿å¤§ç«™ï¼ˆæ–°ç«¹å¸‚è¥¿å¤§è·¯28è™Ÿï¼‰<br>
     ï¼ˆ2ï¼‰è¥¿å¤§äºŒç«™ï¼ˆæ–°ç«¹å¸‚æ±å€è¥¿å¤§è·¯50è™Ÿï¼‰<br>
     ï¼ˆ3ï¼‰è¥¿å¤§ä¸‰ç«™ï¼ˆæ–°ç«¹å¸‚æ±å€è¥¿å¤§è·¯68è™Ÿï¼‰<br>
      æ³¨æ„äº‹é …ï¼š<br>
      1.æä¾›ç²¾ç·»é¤ç›’ï¼ˆ6æ­²ï¼ˆå«ï¼‰ä»¥ä¸‹å­©ç«¥ä¸æä¾›ï¼‰ã€‚<br>
      2.è‹¥æœ‰6æ­²ä»¥ä¸‹å­©ç«¥åŒè¡Œï¼Œå¯è‡³å®¶é•·é€£ç·šå€è§€çœ‹è¡¨æ¼”ã€‚<br>
    </div>
    <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
    <label><span class="required-star">ï¼Š</span>å§“å <input type="text" id="name" placeholder="åƒ…é™å¡«å¯«ä¸€äººï¼Œè«‹å‹¿è¼¸å…¥å¤šä½å§“å" required /></label>
    
    <button class="primary-btn" onclick="goToStep2()">å ±å</button>
    <button class="cancel-btn" onclick="cancelRegistration()">å–æ¶ˆå ±å</button>
</div>

  
<div class="form-container hidden" id="step2">
    <h1>2025è–èª•ç¯€å ±åè¡¨å–®</h1>

    <div class="radio-group">
      <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
      <span><span class="required-star">ï¼Š</span>æ€§åˆ¥ï¼š</span>
      <label><input type="radio" name="gender" value="ç”Ÿç†å¥³" required> ç”Ÿç†å¥³</label>
      <label><input type="radio" name="gender" value="ç”Ÿç†ç”·"> ç”Ÿç†ç”·</label>
    </div>

    <div class="radio-group">
      <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
      <span><span class="required-star">ï¼Š</span>å¹´é½¡å€é–“ï¼š</span><br>
      <label><input type="radio" name="ageGroup" value="0-6"> 0~6</label>
      <label><input type="radio" name="ageGroup" value="7-20"> 7~20</label>
      <label><input type="radio" name="ageGroup" value="21-30"> 21~30</label>
      <label><input type="radio" name="ageGroup" value="31-40"> 31~40</label>
      <label><input type="radio" name="ageGroup" value="41-50"> 41~50</label>
      <label><input type="radio" name="ageGroup" value="51-60"> 51~60</label>
      <label><input type="radio" name="ageGroup" value="60ä»¥ä¸Š"> 60ä»¥ä¸Š</label>
    </div>
    
    <div class="radio-group">
      <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
      <span><span class="required-star">ï¼Š</span>èº«åˆ†åˆ¥ï¼š</span>
      <label><input type="radio" name="identityType" value="æ•™å‹" required onchange="toggleIdentityFields()"> æ•™å‹</label>
      <label><input type="radio" name="identityType" value="æ–°æœ‹å‹" onchange="toggleIdentityFields()"> æ–°æœ‹å‹</label>
    </div>

    <div id="churchMemberFields" class="hidden radio-group">
      <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
      <span><span class="required-star">ï¼Š</span>æ‰€å±¬éƒ¨é–€ï¼š</span><br>
      <label><input type="radio" name="department" value="è–è·è€…"> è–è·è€…</label>
      <label><input type="radio" name="department" value="é•·å¹´éƒ¨"> é•·å¹´éƒ¨</label>
      <label><input type="radio" name="department" value="å®¶åº­å±€"> å®¶åº­å±€</label>
      <label><input type="radio" name="department" value="é’å¹´éƒ¨"> é’å¹´éƒ¨</label>
      <label><input type="radio" name="department" value="å¤§å­¸éƒ¨"> å¤§å­¸éƒ¨</label>
      <label><input type="radio" name="department" value="åœ‹é«˜ä¸­éƒ¨"> åœ‹é«˜ä¸­éƒ¨</label>
      <label><input type="radio" name="department" value="åœ‹å°éƒ¨"> åœ‹å°éƒ¨</label>
      <label><input type="radio" name="department" value="éŠ€æ²³æ°´"> éŠ€æ²³æ°´</label>
    </div>

    <div id="newFriendFields" class="hidden">
      <div class="radio-group">
        <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
        <span><span class="required-star">ï¼Š</span>èº«åˆ†ï¼š</span>
        <label><input type="radio" name="newFriendIdentity" value="å­¸é½¡å‰å…’ç«¥" onchange="toggleStudentFields()"> å­¸é½¡å‰å…’ç«¥</label>
        <label><input type="radio" name="newFriendIdentity" value="åœ¨æ ¡å­¸ç”Ÿ" onchange="toggleStudentFields()"> åœ¨æ ¡å­¸ç”Ÿ</label>
        <label><input type="radio" name="newFriendIdentity" value="ä¸Šç­æ—" onchange="toggleStudentFields()"> ä¸Šç­æ—</label>
        <label><input type="radio" name="newFriendIdentity" value="å·²é€€ä¼‘" onchange="toggleStudentFields()"> å·²é€€ä¼‘</label>
      </div>
      <div id="studentFields" class="hidden">
        <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
        <label><span class="required-star">ï¼Š</span>å­¸æ ¡ç§‘ç³»å¹´ç´š <input type="text" id="schoolInfo" placeholder="ä¾‹ï¼šæ¸…è¯å¤§å­¸ç¶“æ¿Ÿå­¸ç³»ä¸€å¹´ç´š" /></label>
      </div>
      <label>é‚€è«‹äºº <input type="text" id="inviter" placeholder="ä¾‹ï¼šæå¤§ç¾ï¼ˆæ¯å¥³ï¼‰ã€é™³å°æ˜ï¼ˆæœ‹å‹ï¼‰" /></label>
    </div>
    
    <div class="radio-group">
      <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
      <span><span class="required-star">ï¼Š</span>ä¸»è¦åƒèˆ‡å€ï¼š</span>
      <label><input type="radio" name="participationArea" value="5Fä¸»å ´" required> 5Fä¸»å ´</label>
      <label><input type="radio" name="participationArea" value="3Få®¶é•·é€£ç·šå€"> 3Få®¶é•·é€£ç·šå€</label>
    </div>

    <!-- ğŸš¨ æ›´æ”¹ï¼šå°‡æ˜Ÿè™ŸåŒ…åœ¨ span.required-star å…§ -->
    <label><span class="required-star">ï¼Š</span>Email <input type="email" id="email" placeholder="è«‹è¼¸å…¥" required /></label>
    
    <label>å‚™è¨» <input type="text" id="note" placeholder="å…¶ä»–æƒ³èªªçš„è©±" /></label>

    <button class="primary-btn" onclick="submitForm()">æäº¤</button>
    <button class="secondary-btn" onclick="goToStep1()">ä¸Šä¸€æ­¥</button>
    <div class="success-msg" id="responseMsg"></div>
    <div class="error-msg" id="errorMsg"></div>
</div>

<script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwgFCEODYfvyFRTwNo5ugvdn1eCgI3UF20HcK0h1RDu1GhJi_HCB1XEwogIgBpUlekvbg/exec"; // è«‹ç¢ºèªæ­¤ URL å·²æ›¿æ›ç‚ºæ‚¨æœ€æ–°çš„ Apps Script éƒ¨ç½² URL

    function goToStep2() {
      const name = document.getElementById("name").value.trim();
      
      if (!name) {
        // ğŸš¨ çµ±ä¸€ä½¿ç”¨è‡ªå®šç¾©çš„é alert æç¤ºæ–¹å¼ (é€™è£¡æ²¿ç”¨æ‚¨åŸä¾†çš„ alertï¼Œä½†å»ºè­°æ”¹ç”¨è‡ªå®šç¾© UI)
        alert("è«‹è¼¸å…¥å§“å");
        return;
      }
      
      document.getElementById("step1").classList.add("hidden");
      document.getElementById("step2").classList.remove("hidden");
    }

    function goToStep1() {
        document.getElementById("step2").classList.add("hidden");
        document.getElementById("step1").classList.remove("hidden");
    }

    function toggleIdentityFields() {
      const identityType = document.querySelector('input[name="identityType"]:checked')?.value;
      const churchMemberFields = document.getElementById("churchMemberFields");
      const newFriendFields = document.getElementById("newFriendFields");
      const schoolInfoInput = document.getElementById("schoolInfo");
      const inviterInput = document.getElementById("inviter");
      
      // æ•™å‹æ‰€å±¬éƒ¨é–€çš„å–®é¸æŒ‰éˆ•
      const departmentRadios = document.querySelectorAll('#churchMemberFields input[name="department"]');


      // æ¸…ç©ºä¹‹å‰é¸å–çš„å…§å®¹ï¼Œé¿å…è³‡æ–™æ®˜ç•™
      departmentRadios.forEach(rb => rb.checked = false); // ğŸš¨ èª¿æ•´ï¼šæ¸…ç©ºå–®é¸éƒ¨é–€
      const newFriendIdentities = document.querySelectorAll('#newFriendFields input[name="newFriendIdentity"]');
      newFriendIdentities.forEach(rb => rb.checked = false);
      schoolInfoInput.value = '';
      inviterInput.value = '';
      document.getElementById("studentFields").classList.add("hidden"); 

      if (identityType === "æ•™å‹") {
        churchMemberFields.classList.remove("hidden");
        newFriendFields.classList.add("hidden");
        schoolInfoInput.removeAttribute('required');
      } else if (identityType === "æ–°æœ‹å‹") {
        churchMemberFields.classList.add("hidden");
        newFriendFields.classList.remove("hidden");
      } else {
        churchMemberFields.classList.add("hidden");
        newFriendFields.classList.add("hidden");
        schoolInfoInput.removeAttribute('required');
      }
    }

    function toggleStudentFields() {
      const newFriendIdentity = document.querySelector('input[name="newFriendIdentity"]:checked')?.value;
      const studentFields = document.getElementById("studentFields");
      const schoolInfoInput = document.getElementById("schoolInfo");

      if (newFriendIdentity === "åœ¨æ ¡å­¸ç”Ÿ") {
        studentFields.classList.remove("hidden");
        schoolInfoInput.setAttribute('required', 'required');
      } else {
        studentFields.classList.add("hidden");
        schoolInfoInput.removeAttribute('required');
      }
    }

    function submitForm() {
      document.getElementById("responseMsg").innerText = ''; 
      document.getElementById("errorMsg").innerText = '';

      const name = document.getElementById("name").value.trim();
      const participationArea = document.querySelector('input[name="participationArea"]:checked')?.value;
      const gender = document.querySelector('input[name="gender"]:checked')?.value;
      const email = document.getElementById("email").value.trim();
      const ageGroup = document.querySelector('input[name="ageGroup"]:checked')?.value;
      const identityType = document.querySelector('input[name="identityType"]:checked')?.value;
      const note = document.getElementById("note").value.trim();

      // åŸºæœ¬é©—è­‰
      if (!name || !participationArea || !gender || !email || !ageGroup || !identityType) {
        document.getElementById("errorMsg").innerText = "è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½";
        return;
      }

      let department = '';
      if (identityType === "æ•™å‹") {
        // ğŸš¨ èª¿æ•´ï¼šéƒ¨é–€æ¬„ä½ç‚ºå–®é¸
        department = document.querySelector('input[name="department"]:checked')?.value;
        if (!department) {
            document.getElementById("errorMsg").innerText = "è«‹é¸æ“‡æ‰€å±¬éƒ¨é–€";
            return;
        }
      }

      let newFriendIdentity = '';
      let schoolInfo = '';
      let inviter = '';

      if (identityType === "æ–°æœ‹å‹") {
        newFriendIdentity = document.querySelector('input[name="newFriendIdentity"]:checked')?.value;
        if (!newFriendIdentity) {
            document.getElementById("errorMsg").innerText = "è«‹é¸æ“‡æ–°æœ‹å‹èº«åˆ†";
            return;
        }
        if (newFriendIdentity === "åœ¨æ ¡å­¸ç”Ÿ") {
          schoolInfo = document.getElementById("schoolInfo").value.trim();
          if (!schoolInfo) {
              document.getElementById("errorMsg").innerText = "è«‹å¡«å¯«å­¸æ ¡ç§‘ç³»å¹´ç´š";
              return;
          }
        }
        inviter = document.getElementById("inviter").value.trim();
      }

      const formData = new URLSearchParams({
        action: "register",
        name,
        participationArea,
        gender,
        email,
        ageGroup,
        identityType,
        department,        // æ•™å‹éƒ¨é–€ (å–®ä¸€å€¼)
        newFriendIdentity, // æ–°æœ‹å‹èº«åˆ†
        schoolInfo,        // å­¸ç”Ÿå­¸æ ¡è³‡è¨Š
        inviter,           // é‚€è«‹äºº
        note
      });

      fetch(scriptURL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formData.toString()
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === "success") {
            document.getElementById("responseMsg").innerText = "å ±åæˆåŠŸï¼Œæ„Ÿè¬æ‚¨ï¼å·²å¯„é€ç¢ºèªä¿¡è‡³æ‚¨çš„ä¿¡ç®±ã€‚";
            document.getElementById("errorMsg").innerText = ''; // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
            console.log("æˆåŠŸï¼š", data);
        } else {
            document.getElementById("errorMsg").innerText = data.message || "é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
            document.getElementById("responseMsg").innerText = ''; // æ¸…é™¤æˆåŠŸè¨Šæ¯
            console.error("éŒ¯èª¤ï¼š", data);
        }
      })
      .catch(error => {
        document.getElementById("errorMsg").innerText = "ç¶²è·¯éŒ¯èª¤ï¼Œé€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
        document.getElementById("responseMsg").innerText = ''; // æ¸…é™¤æˆåŠŸè¨Šæ¯
        console.error("éŒ¯èª¤ï¼š", error);
      });
    }

    function cancelRegistration() {
        document.getElementById("responseMsg").innerText = '';
        document.getElementById("errorMsg").innerText = '';

        const name = document.getElementById("name").value.trim();
        // ğŸš¨ çµ±ä¸€ä½¿ç”¨è‡ªå®šç¾©çš„é alert æç¤ºæ–¹å¼ (é€™è£¡æ²¿ç”¨æ‚¨åŸä¾†çš„ prompt/alertï¼Œä½†å»ºè­°æ”¹ç”¨è‡ªå®šç¾© UI)
        const email = prompt("è«‹è¼¸å…¥æ‚¨çš„Emailä»¥ç¢ºèªå–æ¶ˆå ±åï¼š"); 

        if (!name || !email) {
            alert("è«‹è¼¸å…¥å§“ååŠEmailæ‰èƒ½å–æ¶ˆå ±å");
            return;
        }

        const formData = new URLSearchParams({
            action: "cancel",
            name,
            email 
        });

        fetch(scriptURL, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData.toString()
        })
        .then(response => response.json()) 
        .then(data => {
            if (data.status === "success") {
                alert(data.message || "å–æ¶ˆå ±åæˆåŠŸï¼");
            } else {
                alert(data.message || "å–æ¶ˆå ±åå¤±æ•—ï¼Œè«‹æª¢æŸ¥å§“åèˆ‡Emailæ˜¯å¦æ­£ç¢ºã€‚");
            }
        })
        .catch(error => {
            alert("å–æ¶ˆå ±åå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            console.error("éŒ¯èª¤ï¼š", error);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        toggleIdentityFields();
        toggleStudentFields();
    });

</script>

